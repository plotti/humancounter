<!DOCTYPE html>
<html>
  <head>
    <!-- EXTERNAL LIBS-->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
    <script src="https://www.google.com/jsapi"></script>

    <!-- EXAMPLE SCRIPT -->
    <script>

      // onload callback
      function drawChart() {
        var deviceID = "240034001147343339383037";
        var accessToken = "800efcf08f1f961e4438ece0da1a20bc5ccfb4f4";
        var eventSource = new EventSource("https://api.spark.io/v1/devices/" + deviceID + "/events/?access_token=" + accessToken);

        eventSource.addEventListener('open', function(e) {
            console.log("Opened!"); },false);

        eventSource.addEventListener('error', function(e) {
            console.log("Errored!"); },false);

        eventSource.addEventListener('humancount', function(e) {
            console.log("Received Stuff!" + e);

            var parsedData = JSON.parse(e.data);
            var tsSpan   = document.getElementById("published_at");
            var data = new google.visualization.DataTable();
            data.addColumn('datetime', 'Time');
            data.addColumn('number', 'Humans');

            data.addRow([(Date.parse(tsSpan)),1]);
            var chart = new google.visualization.LineChart($('#chart').get(0));
            chart.draw(data, {title: 'People on Stairs'});
        });
      }

      // load chart lib
      google.load('visualization', '1', {
        packages: ['corechart']
      });

      // call drawChart once google charts is loaded
      google.setOnLoadCallback(drawChart);

    </script>

  </head>
  <body>
    <div id="chart" style="width: 100%;"></div>
  </body>
</html>